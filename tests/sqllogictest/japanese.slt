# need ipadic flag for lindera

statement ok
BEGIN;

statement ok
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    passage TEXT,
    embedding Bm25Vector
);

statement ok
SELECT tokenizer_catalog.create_lindera_model('lindera_ipadic', $$
[segmenter]
mode = "normal"
  [segmenter.dictionary]
  kind = "ipadic"
[[character_filters]]
kind = "unicode_normalize"
  [character_filters.args]
  kind = "nfkc"
[[character_filters]]
kind = "japanese_iteration_mark"
  [character_filters.args]
  normalize_kanji = true
  normalize_kana = true
[[character_filters]]
kind = "mapping"
[character_filters.args.mapping]
"リンデラ" = "Lindera"
[[token_filters]]
kind = "japanese_compound_word"
  [token_filters.args]
  kind = "ipadic"
  tags = [ "名詞,数", "名詞,接尾,助数詞" ]
  new_tag = "名詞,数"
[[token_filters]]
kind = "japanese_number"
  [token_filters.args]
  tags = [ "名詞,数" ]
[[token_filters]]
kind = "japanese_stop_tags"
  [token_filters.args]
  tags = [
  "接続詞",
  "助詞",
  "助詞,格助詞",
  "助詞,格助詞,一般",
  "助詞,格助詞,引用",
  "助詞,格助詞,連語",
  "助詞,係助詞",
  "助詞,副助詞",
  "助詞,間投助詞",
  "助詞,並立助詞",
  "助詞,終助詞",
  "助詞,副助詞／並立助詞／終助詞",
  "助詞,連体化",
  "助詞,副詞化",
  "助詞,特殊",
  "助動詞",
  "記号",
  "記号,一般",
  "記号,読点",
  "記号,句点",
  "記号,空白",
  "記号,括弧閉",
  "その他,間投",
  "フィラー",
  "非言語音"
]
[[token_filters]]
kind = "japanese_katakana_stem"
  [token_filters.args]
  min = 3
[[token_filters]]
kind = "remove_diacritical_mark"
  [token_filters.args]
  japanese = false
$$);

statement ok
SELECT tokenizer_catalog.create_tokenizer('lindera_ipadic', $$
model = "lindera_ipadic"
$$);

statement ok
INSERT INTO documents (passage) VALUES 
('どこで生れたかとんと見当けんとうがつかぬ。'),
('何でも薄暗いじめじめした所でニャーニャー泣いていた事だけは記憶している。'),
('吾輩はここで始めて人間というものを見た。'),
('しかもあとで聞くとそれは書生という人間中で一番獰悪どうあくな種族であったそうだ。'),
('この書生というのは時々我々を捕つかまえて煮にて食うという話である。'),
('しかしその当時は何という考もなかったから別段恐しいとも思わなかった。'),
('ただ彼の掌てのひらに載せられてスーと持ち上げられた時何だかフワフワした感じがあったばかりである。'),
('掌の上で少し落ちついて書生の顔を見たのがいわゆる人間というものの見始みはじめであろう。'),
('この時妙なものだと思った感じが今でも残っている。'),
('第一毛をもって装飾されべきはずの顔がつるつるしてまるで薬缶やかんだ。'),
('その後ご猫にもだいぶ逢あったがこんな片輪かたわには一度も出会でくわした事がない。'),
('のみならず顔の真中があまりに突起している。'),
('そうしてその穴の中から時々ぷうぷうと煙けむりを吹く。'),
('どうも咽むせぽくて実に弱った。'),
('これが人間の飲む煙草たばこというものである事はようやくこの頃知った。');

statement ok
UPDATE documents SET embedding = tokenizer_catalog.tokenize(passage, 'lindera_ipadic');

query T
SELECT embedding FROM documents ORDER BY id;
----
{25551:1, 43605:1, 47803:1, 50430:1, 50642:1, 289707:1, 343719:1}
{5521:1, 6653:1, 30760:2, 34143:1, 46600:2, 128785:1, 221942:1, 270416:1, 335121:1, 347079:1}
{26291:1, 46600:1, 74453:1, 123331:1, 162466:1, 183351:1, 342799:1}
{986:1, 2157:1, 37937:1, 38969:1, 47727:1, 50467:1, 103584:1, 114808:1, 123331:1, 244898:1, 287313:1, 305960:1, 323448:1}
{27307:1, 43718:1, 46600:1, 55829:1, 221161:2, 229750:1, 242775:1, 244898:1, 283049:1, 348010:1, 381427:1}
{5948:1, 18774:1, 38471:1, 51066:1, 128785:1, 142407:1, 210846:1, 216288:1, 216872:1, 322296:1}
{1847:1, 30760:1, 46600:1, 62674:1, 79055:2, 89935:1, 96875:1, 128800:1, 211395:1, 219390:1, 228176:1, 230575:1, 242659:1, 357851:1}
{6879:1, 46600:1, 55829:1, 58195:1, 69979:1, 74453:1, 106819:1, 123331:1, 183334:1, 194792:1, 230575:1, 244898:1, 333301:1, 342799:2, 379889:1}
{6653:1, 27307:1, 46600:1, 74453:1, 123700:1, 183036:1, 216254:1, 219390:1, 242659:1, 263602:1}
{19301:1, 28484:1, 30760:1, 46356:1, 46600:1, 58238:1, 69767:1, 79338:1, 102657:1, 311059:1, 335468:1, 338938:1, 379889:1}
{1847:1, 17346:1, 19677:1, 24633:1, 28148:1, 28202:1, 38491:1, 41906:1, 50958:1, 80174:1, 102657:1, 120341:1, 139477:1, 284425:1, 286995:1, 358011:1}
{2653:1, 6653:1, 30760:1, 46600:1, 52666:1, 56527:1, 298243:1, 308071:1, 379889:1}
{25489:1, 38471:1, 114800:1, 162204:1, 242775:1, 282627:1, 306773:1}
{46600:1, 50528:1, 67854:1, 72292:1, 164414:1, 186987:1, 209733:1}
{27307:1, 27870:1, 41251:1, 74453:1, 77576:1, 120341:1, 123331:1, 282697:1, 299988:1, 378928:1, 382190:1}

statement ok
SELECT tokenizer_catalog.drop_lindera_model('lindera_ipadic');
